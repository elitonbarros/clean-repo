<!DOCTYPE html>
<html>
<head>
  <title>Twilio Outbound Call</title>
  <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>
</head>
<body>
  <h2>Make a Call from your Twilio Number</h2>
  <input type="text" id="phoneNumber" placeholder="+15551234567" />
  <button onclick="makeCall()">Call Now</button>

<script src="https://media.twiliocdn.com/sdk/js/client/v1.10/twilio.min.js"></script>
<script>
  fetch('/token')
    .then(response => response.text()) // changed from .json() to .text()
    .then(token => {
      console.log("âœ… Token fetched:", token);
      Twilio.Device.setup(token);

      Twilio.Device.ready(function () {
        console.log("ğŸ‰ Device is ready!");
      });

      Twilio.Device.error(function (error) {
        console.error("âŒ Twilio.Device error:", error.message);
      });
    })
    .catch(error => {
      console.error("âŒ Failed to fetch token:", error);
    });

  function call() {
    const params = { To: document.getElementById('number').value };
    console.log("ğŸ“ Making call with params:", params);
    Twilio.Device.connect(params);
  }
</script>
</body>
</html>
