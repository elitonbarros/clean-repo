<!DOCTYPE html>
<html>
<head>
  <title>Twilio Outbound Call</title>
  <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>
</head>
<body>
  <h2>Make a Call from your Twilio Number</h2>
  <input type="text" id="phoneNumber" placeholder="+15551234567" />
  <button onclick="makeCall()">Call Now</button>

  <script>
    let device;

    // Fetch access token from your server
    fetch('https://twilio-outbound-call.onrender.com/token')
      .then(response => response.text())
      .then(token => {
        device = new Twilio.Device(token, {
          codecPreferences: ['opus', 'pcmu'],
          fakeLocalDTMF: true,
          enableRingingState: true
        });

        device.on('ready', () => console.log('üìû Device is ready!'));
        device.on('error', error => console.error('‚ùå Device Error:', error));
        device.on('connect', () => console.log('‚úÖ Call connected'));
        device.on('disconnect', () => console.log('üì¥ Call disconnected'));

        device.register(); // Important!
      })
      .catch(error => console.error('‚ö†Ô∏è Failed to get token:', error));

    function makeCall() {
      const number = document.getElementById('phoneNumber').value;
      if (!device) {
        alert("Device not ready yet.");
        return;
      }
      device.connect({ To: number });
    }
  </script>
</body>
</html>
